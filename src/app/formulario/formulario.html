<div class="contenedor-crud">
  <!-- Encabezado y botones de acciÃ³n -->
  <header class="header-crud">
    <div class="header-top">
      <button class="btn btn-volver" (click)="volver()">â† Volver</button>
      <h1>ğŸ”¥ PokÃ©dex CRUD</h1>
    </div>
    <p>GestiÃ³n de PokÃ©mon</p>
  </header>

  <!-- Mensaje de estado -->
  <div *ngIf="mensaje" class="mensaje" [ngClass]="mensaje.includes('âœ“') ? 'exito' : 'error'">
    {{ mensaje }}
  </div>

  <!-- SecciÃ³n de Listado -->
  <section class="seccion-listado" *ngIf="modo === 'listar'">
    <div class="botones-accion">
      <button (click)="abrirCrear()" class="btn btn-crear" [disabled]="cargando">
        â• Crear nuevo PokÃ©mon
      </button>
      <button (click)="obtenerPokemones()" class="btn btn-refrescar" [disabled]="cargando">
        ğŸ”„ Refrescar lista
      </button>
    </div>

    <div *ngIf="cargando" class="spinner">
      <p>Cargando...</p>
    </div>

    <div *ngIf="!cargando && pokemones.length === 0" class="sin-datos">
      <p>No hay PokÃ©mon registrados. Â¡Crea uno nuevo!</p>
    </div>

    <div *ngIf="!cargando && pokemones.length > 0" class="tabla-contenedor">
      <table class="tabla">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Tipo</th>
            <th>â­ Favorito</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let pokemon of pokemones" [class.favorito]="pokemon.favorito">
            <td>{{ pokemon.id }}</td>
            <td>{{ pokemon.nombre }}</td>
            <td><span class="tipo-badge">{{ pokemon.tipo }}</span></td>
            <td class="celda-favorito">
              <span *ngIf="pokemon.favorito" class="estrella">â­</span>
              <span *ngIf="!pokemon.favorito" class="gris">â˜†</span>
            </td>
            <td class="celda-acciones">
              <button (click)="abrirEdicion(pokemon)" class="btn btn-editar">âœï¸ Editar</button>
              <button (click)="eliminarPokemon(pokemon.id!)" class="btn btn-eliminar">ğŸ—‘ï¸ Eliminar</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- SecciÃ³n de Formulario (Crear o Editar) -->
  <section class="seccion-formulario" *ngIf="modo === 'crear' || modo === 'editar'">
    <div class="formulario-card">
      <h2>{{ modo === 'crear' ? 'âœ¨ Crear nuevo PokÃ©mon' : 'âœï¸ Editar PokÃ©mon' }}</h2>

      <form [formGroup]="formulario" class="formulario">
        <div class="form-grupo">
          <label for="nombre">Nombre <span class="requerido">*</span></label>
          <input
            id="nombre"
            type="text"
            formControlName="nombre"
            placeholder="ej: Pikachu"
            class="input"
          />
          <small *ngIf="campoEsInvalido('nombre')" class="error">
            Nombre requerido (mÃ­nimo 2 caracteres).
          </small>
        </div>

        <div class="form-grupo">
          <label for="tipo">Tipo <span class="requerido">*</span></label>
          <select id="tipo" formControlName="tipo" class="input">
            <option value="">-- Selecciona un tipo --</option>
            <option value="Fuego">ğŸ”¥ Fuego</option>
            <option value="Agua">ğŸ’§ Agua</option>
            <option value="ElÃ©ctrico">âš¡ ElÃ©ctrico</option>
            <option value="Planta">ğŸŒ¿ Planta</option>
            <option value="Hielo">â„ï¸ Hielo</option>
            <option value="Lucha">ğŸ‘Š Lucha</option>
            <option value="Veneno">â˜ ï¸ Veneno</option>
            <option value="Tierra">ğŸª¨ Tierra</option>
            <option value="Volador">ğŸ¦… Volador</option>
            <option value="PsÃ­quico">ğŸ§  PsÃ­quico</option>
            <option value="Bicho">ğŸ› Bicho</option>
            <option value="Roca">â›°ï¸ Roca</option>
            <option value="Fantasma">ğŸ‘» Fantasma</option>
            <option value="DragÃ³n">ğŸ‰ DragÃ³n</option>
            <option value="Siniestro">ğŸ˜ˆ Siniestro</option>
            <option value="Acero">âš™ï¸ Acero</option>
            <option value="Hada">âœ¨ Hada</option>
          </select>
          <small *ngIf="campoEsInvalido('tipo')" class="error">
            El tipo es requerido.
          </small>
        </div>

        <div class="form-grupo checkbox">
          <label>
            <input type="checkbox" formControlName="favorito" />
            <span>â­ Agregar a favoritos</span>
          </label>
        </div>

        <div class="botones-formulario">
          <button
            *ngIf="modo === 'crear'"
            type="button"
            (click)="crearPokemon()"
            class="btn btn-guardar"
            [disabled]="cargando"
          >
            {{ cargando ? 'â³ Guardando...' : 'ğŸ’¾ Crear PokÃ©mon' }}
          </button>

          <button
            *ngIf="modo === 'editar'"
            type="button"
            (click)="editarPokemon()"
            class="btn btn-guardar"
            [disabled]="cargando"
          >
            {{ cargando ? 'â³ Guardando...' : 'ğŸ’¾ Actualizar PokÃ©mon' }}
          </button>

          <button
            type="button"
            (click)="cancelarEdicion()"
            class="btn btn-cancelar"
            [disabled]="cargando"
          >
            âŒ Cancelar
          </button>
        </div>
      </form>
    </div>
  </section>
</div>
